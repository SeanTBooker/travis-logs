language: ruby
rvm:
- 2.4.1
sudo: required
dist: trusty
cache:
  bundler: true
  directories:
  - ${HOME}/perl5
  - ${HOME}/.cache
services:
- redis
- rabbitmq
addons:
  postgresql: 9.6
  apt:
    packages:
    - postgresql-9.6-server-dev-all
    - postgresql-9.6-common
env:
  global:
  - PG_DISABLE_SSL='1'
before_install:
- script/install-sqitch
- script/install-partman
- eval "$(perl -I ~/perl5/lib/perl5/ '-Mlocal::lib')"
- gem update bundler
before_script:
- bundle exec rake setup
